<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prince Alex Online Store - Fresh Veggies from Kenya</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4CAF50; /* A fresh green */
            --secondary-color: #8BC34A; /* Lighter green */
            --text-color: #333;
            --light-bg: #f9f9f9;
            --white: #fff;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --border-color: #ddd;
            --dark-text: #222;
            --star-color: #FFD700; /* Gold for stars */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary-color: #66BB6A;
            --secondary-color: #9CCC65;
            --text-color: #E0E0E0;
            --light-bg: #2C2C2C;
            --white: #3A3A3A;
            --shadow: 0 4px 8px rgba(0,0,0,0.4);
            --border-color: #555;
            --dark-text: #F0F0F0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            transition: color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary-color);
        }

        .nav-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-icons span, .nav-icons button {
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 18px;
            transition: color 0.3s;
        }
        .nav-icons span:hover, .nav-icons button:hover {
            color: var(--primary-color);
        }

        .hamburger-menu {
            display: none; /* Hidden on desktop */
            font-size: 24px;
            cursor: pointer;
        }

        main {
            flex-grow: 1;
        }

        section {
            padding: 60px 0;
            display: none; /* Hide all pages by default */
        }
        
        section.active {
            display: block; /* Show active page */
        }

        .hero {
            position: relative; /* For image carousel */
            text-align: center;
            padding: 100px 20px;
            border-radius: 10px;
            margin-bottom: 40px;
            overflow: hidden; /* Hide overflowing images */
            height: 400px; /* Fixed height for hero section */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .hero-background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            z-index: 1;
        }
        .hero-background-image.active {
            opacity: 1;
        }
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 2;
        }
        body.dark-mode .hero-overlay {
            background: rgba(0,0,0,0.6);
        }

        .hero-content {
            position: relative;
            z-index: 3;
        }

        .hero h1 {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .hero p {
            font-size: 20px;
            color: var(--dark-text);
            margin-bottom: 30px;
        }

        .cta-button {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .cta-button:hover {
            background-color: var(--secondary-color);
        }

        .section-title {
            text-align: center;
            font-size: 36px;
            margin-bottom: 40px;
            color: var(--primary-color);
        }

        .product-grid, .features-grid, .contact-info, .social-links, .about-content, .admin-orders-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        .product-grid.list-view {
            grid-template-columns: 1fr;
        }

        .product-card, .feature-item, .order-card, .contact-submission-card {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, background-color 0.3s, box-shadow 0.3s;
            position: relative; /* For badges */
        }
        .product-grid.list-view .product-card {
            display: flex;
            text-align: left;
            gap: 20px;
            align-items: center;
        }
        .product-grid.list-view .product-card img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .product-grid.list-view .product-card .product-info {
            flex-grow: 1;
        }
        .product-grid.list-view .product-card .product-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .product-card h3 {
            font-size: 20px;
            margin-bottom: 5px;
            color: var(--dark-text);
        }

        .product-card .price {
            font-size: 18px;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 10px;
        }
        .product-card .price del {
            color: #999;
            margin-right: 8px;
            font-size: 0.9em;
        }

        .add-to-cart-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .add-to-cart-btn:hover {
            background-color: var(--secondary-color);
        }
        .add-to-cart-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .features-grid .feature-item h4 {
            color: var(--primary-color);
            margin-top: 10px;
        }

        .cart-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .cart-table th, .cart-table td {
            text-align: left;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--dark-text);
        }

        .cart-table th {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .cart-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quantity-controls button {
            background-color: var(--border-color);
            border: none;
            width: 30px;
            height: 30px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            color: var(--dark-text);
        }
        .quantity-controls button:hover {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .cart-summary-totals {
            text-align: right;
            margin-top: 20px;
            color: var(--dark-text);
        }
        .cart-summary-totals div {
            font-size: 18px;
            margin-bottom: 5px;
        }
        .cart-summary-totals .cart-total-grand {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
            margin-top: 10px;
        }

        .checkout-btn {
            display: block;
            margin-top: 20px;
            width: 100%;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: var(--secondary-color);
        }

        .forms-container, .contact-form-container, .admin-panel-login, .auth-modal-content {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        .admin-form input, .admin-form textarea, .contact-form input, .contact-form textarea, .order-track-form input, .admin-panel-login input, .checkout-form input, .payment-form input, .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: inherit;
            background-color: var(--light-bg);
            color: var(--text-color);
            transition: border-color 0.3s, background-color 0.3s;
        }
        .admin-form input:focus, .admin-form textarea:focus, .contact-form input:focus, .contact-form textarea:focus, .order-track-form input:focus, .admin-panel-login input:focus, .checkout-form input:focus, .payment-form input:focus, .auth-form input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .payment-option {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .payment-option:hover {
            background-color: #e0e0e0;
            border-color: var(--primary-color);
        }
        .payment-option input[type="radio"] {
            width: auto;
            margin-bottom: 0;
        }
        body.dark-mode .payment-option:hover {
            background-color: #444;
        }

        .admin-form button, .contact-form button, .order-track-form button, .admin-panel-login button, .checkout-form button, .payment-form button, .auth-form button, .newsletter-form button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }

        .admin-form button:hover, .contact-form button:hover, .order-track-form button:hover, .admin-panel-login button:hover, .checkout-form button:hover, .payment-form button:hover, .auth-form button:hover, .newsletter-form button:hover {
            background-color: var(--secondary-color);
        }

        #order-status {
            text-align: center;
            font-size: 20px;
            margin-top: 20px;
            color: var(--dark-text);
        }
        #order-status strong {
            color: var(--primary-color);
        }

        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        footer {
            background-color: var(--dark-text);
            color: var(--white);
            padding: 40px 0;
            margin-top: auto;
            transition: background-color 0.3s;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .footer-column h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .footer-column a {
            color: var(--white);
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
            transition: color 0.3s;
        }
        
        .footer-column a:hover {
            color: var(--primary-color);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .social-links a {
            font-size: 24px;
            color: var(--white);
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: var(--primary-color);
        }

        .whatsapp-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .whatsapp-widget a {
            background-color: #25D366;
            color: var(--white);
            padding: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 24px;
            text-decoration: none;
            transition: transform 0.3s;
        }
        .whatsapp-widget a:hover {
            transform: scale(1.1);
        }

        /* Success/Error Message Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
            transform: translateY(-50px);
            opacity: 0;
            animation: fadeInDown 0.3s forwards;
            color: var(--dark-text);
        }

        @keyframes fadeInDown {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .modal-content p {
            margin-bottom: 20px;
            font-size: 16px;
        }

        .modal-content button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .modal-content button:hover {
            background-color: var(--secondary-color);
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-color);
        }
        .close-button:hover {
            color: var(--primary-color);
        }

        /* Order Confirmation Page Specific Styling */
        #order-confirmation-page .order-details {
            background-color: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            text-align: center;
            color: var(--dark-text);
        }
        #order-confirmation-page .order-details h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        #order-confirmation-page .order-details p {
            margin-bottom: 10px;
            font-size: 18px;
        }
        #order-confirmation-page .order-details strong {
            color: var(--primary-color);
        }

        /* Product Sorting and Filter Bar */
        .shop-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            justify-content: center;
        }
        .shop-controls input, .shop-controls select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: inherit;
            background-color: var(--light-bg);
            color: var(--text-color);
            transition: border-color 0.3s, background-color 0.3s;
        }
        .shop-controls button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .shop-controls button:hover {
            background-color: var(--secondary-color);
        }

        /* Admin Panel - Orders and Products List */
        .admin-section {
            margin-top: 40px;
            background-color: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            color: var(--dark-text);
        }
        .admin-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        .admin-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .admin-list-item:last-child {
            border-bottom: none;
        }
        .admin-list-item button {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        .admin-list-item .delete-btn {
            background-color: #f44336;
            color: var(--white);
            border: none;
        }
        .admin-list-item .delete-btn:hover {
            background-color: #d32f2f;
        }
        .admin-list-item .mark-delivered-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
        }
        .admin-list-item .mark-delivered-btn:hover {
            background-color: var(--secondary-color);
        }
        .admin-list-item .status-delivered {
            color: var(--primary-color);
            font-weight: 600;
        }
        .admin-list-item .order-items-list {
            font-size: 0.9em;
            color: #666;
        }
        body.dark-mode .admin-list-item .order-items-list {
            color: #ccc;
        }
        /* Product Ratings */
        .product-rating {
            color: var(--star-color);
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .product-rating .far { /* Empty star */
            color: #ccc;
        }
        /* Product Badges */
        .product-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary-color);
            color: var(--white);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: 600;
            z-index: 10;
        }
        .product-badge.new {
            background-color: #2196F3;
        } /* Blue */
        .product-badge.bestseller {
            background-color: #FFC107;
        } /* Amber */
        .product-badge.organic {
            background-color: #4CAF50;
        } /* Green */
        .product-badge.discount {
            background-color: #F44336;
        } /* Red */
        /* Stock Indicator */
        .stock-indicator {
            font-size: 0.9em;
            margin-top: 5px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .stock-indicator.in-stock {
            color: var(--primary-color);
        }
        .stock-indicator.sold-out {
            color: #f44336;
        }
        /* Favorite Icon */
        .favorite-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.3em;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
            z-index: 10;
        }
        .favorite-icon.fas { /* Filled heart */
            color: #E91E63; /* Pink */
        }
        .favorite-icon:hover {
            color: #E91E63;
        }
        /* Quick View Modal */
        #quick-view-modal .modal-content {
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            text-align: left;
        }
        #quick-view-modal .modal-content .product-details {
            display: flex;
            gap: 20px;
        }
        #quick-view-modal .modal-content .product-details img {
            width: 50%;
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        #quick-view-modal .modal-content .product-info-qv {
            flex-grow: 1;
        }
        #quick-view-modal .modal-content h3 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        #quick-view-modal .modal-content .price-qv {
            font-size: 22px;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
        }
        #quick-view-modal .modal-content .price-qv del {
            color: #999;
            margin-right: 10px;
            font-size: 0.8em;
        }
        #quick-view-modal .modal-content .description-qv {
            margin-bottom: 20px;
            color: var(--dark-text);
        }
        #quick-view-modal .modal-content .add-to-cart-btn-qv {
            width: auto;
            padding: 12px 25px;
            font-size: 16px;
        }
        #quick-view-modal .modal-content .product-tags {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        #quick-view-modal .modal-content .product-tag {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .reviews-section {
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            text-align: left;
        }
        .reviews-section h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        .review-item {
            background-color: var(--light-bg);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .review-item strong {
            color: var(--dark-text);
        }
        .review-item .review-rating {
            color: var(--star-color);
            font-size: 0.9em;
        }
        .add-review-form input, .add-review-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-family: inherit;
        }
        .add-review-form button {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9em;
        }
        /* My Account Page Styling */
        #my-account-page .account-section {
            background-color: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            color: var(--dark-text);
        }
        #my-account-page .account-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        #my-account-page .account-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        #my-account-page .profile-info-card {
            background-color: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        #my-account-page .profile-info-card p {
            margin-bottom: 10px;
        }
        #my-account-page .profile-info-card strong {
            color: var(--primary-color);
        }
        #my-account-page .account-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        #my-account-page .account-buttons .cta-button {
            width: auto;
            padding: 12px 25px;
            font-size: 16px;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .nav-links {
                display: none; /* Hide by default on mobile */
                flex-direction: column;
                width: 100%;
                background-color: var(--white);
                position: absolute;
                top: 70px; /* Adjust based on header height */
                left: 0;
                box-shadow: var(--shadow);
                padding: 20px 0;
                text-align: center;
            }
            .nav-links.active {
                display: flex; /* Show when active */
            }
            .nav-links li {
                margin-bottom: 10px;
            }
            .hamburger-menu {
                display: block; /* Show hamburger on mobile */
            }
            nav {
                flex-wrap: wrap;
            }
            .nav-icons {
                order: 1; /* Place icons first on small screens */
            }
            .logo {
                order: 2;
                flex-grow: 1;
                text-align: center;
            }
            .hamburger-menu {
                order: 3;
            }
            .hero h1 {
                font-size: 36px;
            }
            .product-grid, .features-grid, .admin-orders-grid {
                grid-template-columns: 1fr;
            }
            .footer-grid {
                grid-template-columns: 1fr;
            }
            .shop-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .shop-controls input, .shop-controls select, .shop-controls button {
                width: 100%;
            }
            #quick-view-modal .modal-content .product-details {
                flex-direction: column;
                align-items: center;
            }
            #quick-view-modal .modal-content .product-details img {
                width: 100%;
                max-width: 100%;
            }
            .product-grid.list-view .product-card {
                flex-direction: column;
                text-align: center;
            }
            .product-grid.list-view .product-card .product-actions {
                align-items: center;
            }
            #my-account-page .account-details-grid {
                grid-template-columns: 1fr;
            }
            #my-account-page .account-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <nav>
                <div class="logo">Prince Alex Store</div>
                <ul class="nav-links" id="nav-links">
                    <li><a href="#" class="page-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="page-link" data-page="shop">Shop</a></li>
                    <li><a href="#" class="page-link" data-page="cart">Cart</a></li>
                    <li><a href="#" class="page-link" data-page="track-order">Track Order</a></li>
                    <li><a href="#" class="page-link" data-page="about">About</a></li>
                    <li><a href="#" class="page-link" data-page="contact">Contact</a></li>
                </ul>
                <div class="nav-icons">
                    <span id="dark-mode-toggle" class="fas fa-moon"></span>
                    <span class="fas fa-search" id="search-icon"></span>
                    <span class="fas fa-heart" id="wishlist-icon"></span>
                    <a href="#" class="cart-icon" data-page="cart">
                        <span class="fas fa-shopping-cart"></span>
                        <span class="cart-count" id="cart-count">0</span>
                    </a>
                    <a href="#" class="account-icon" data-page="auth">
                        <span class="fas fa-user-circle"></span>
                    </a>
                    <div class="hamburger-menu" id="hamburger-menu">&#9776;</div>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="home-page" class="active">
            <div class="hero">
                <img id="hero-bg-1" class="hero-background-image active" src="https://princealextrading.netlify.app/assets/farm-1-bg-p5lD3z2h.jpg" alt="Hero Background 1">
                <img id="hero-bg-2" class="hero-background-image" src="https://princealextrading.netlify.app/assets/farm-2-bg-2r6E4z5t.jpg" alt="Hero Background 2">
                <div class="hero-overlay"></div>
                <div class="hero-content">
                    <h1>Fresh & Healthy Groceries Delivered to Your Doorstep</h1>
                    <p>Sourced directly from local farms in Kenya. Quality and freshness guaranteed.</p>
                    <a href="#shop-page" class="cta-button page-link" data-page="shop">Shop Now</a>
                </div>
            </div>

            <h2 class="section-title">Why Choose Us?</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <span class="fas fa-leaf fa-3x" style="color: var(--primary-color);"></span>
                    <h4>Farm Fresh</h4>
                    <p>Produce delivered within hours of harvest for maximum freshness and flavor.</p>
                </div>
                <div class="feature-item">
                    <span class="fas fa-truck fa-3x" style="color: var(--primary-color);"></span>
                    <h4>Fast Delivery</h4>
                    <p>Same-day or next-day delivery options to get your groceries to you quickly.</p>
                </div>
                <div class="feature-item">
                    <span class="fas fa-hand-holding-heart fa-3x" style="color: var(--primary-color);"></span>
                    <h4>Supporting Local</h4>
                    <p>We work directly with small-scale Kenyan farmers, ensuring fair prices and sustainability.</p>
                </div>
            </div>

            <h2 class="section-title">Our Best Sellers</h2>
            <div class="product-grid" id="featured-products">
                </div>
        </section>

        <section id="shop-page">
            <h2 class="section-title">Fresh Produce</h2>
            <div class="shop-controls">
                <input type="text" id="search-bar" placeholder="Search products...">
                <select id="category-filter">
                    <option value="all">All Categories</option>
                    <option value="vegetables">Vegetables</option>
                    <option value="fruits">Fruits</option>
                    <option value="herbs">Herbs</option>
                    <option value="grains">Grains</option>
                    <option value="dairy">Dairy & Eggs</option>
                    <option value="other">Other</option>
                </select>
                <select id="sort-by">
                    <option value="default">Default Sort</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="rating-desc">Top Rated</option>
                    <option value="newest">Newest First</option>
                </select>
                <button id="grid-view-btn" class="fas fa-th"></button>
                <button id="list-view-btn" class="fas fa-list"></button>
            </div>
            <div class="product-grid" id="all-products">
                </div>
        </section>

        <section id="cart-page">
            <h2 class="section-title">Your Cart</h2>
            <div id="cart-content">
                <table class="cart-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="cart-items-body">
                        </tbody>
                </table>
                <div id="cart-empty-message" style="text-align: center; display: none;">Your cart is empty.</div>
                <div class="cart-summary-totals">
                    <div>Subtotal: <span id="cart-subtotal">KES 0.00</span></div>
                    <div>Delivery Fee: <span id="cart-delivery-fee">KES 0.00</span></div>
                    <div class="cart-total-grand">Total: <span id="cart-total">KES 0.00</span></div>
                    <button class="checkout-btn" id="checkout-button">Proceed to Checkout</button>
                </div>
            </div>
        </section>

        <section id="track-order-page">
            <h2 class="section-title">Track Your Order</h2>
            <div class="forms-container">
                <form id="track-order-form">
                    <input type="text" id="order-id-input" placeholder="Enter Order ID" required>
                    <button type="submit">Track Order</button>
                </form>
                <div id="order-status"></div>
            </div>
        </section>

        <section id="about-page">
            <h2 class="section-title">About Prince Alex Online Store</h2>
            <div class="about-content">
                <p>Prince Alex Online Store is a family-owned business committed to bringing the freshest, highest-quality farm produce from local Kenyan farms directly to your home. We believe in sustainable agriculture, supporting local communities, and providing a convenient and reliable way to get healthy food.</p>
                <p>Our mission is to bridge the gap between farmers and consumers, ensuring fair prices for our farmers and a transparent supply chain for our customers. Every purchase you make helps support local economies and promotes a healthier lifestyle.</p>
            </div>
            <div class="map-container">
                <img src="https://princealextrading.netlify.app/assets/map-placeholder-11234.png" alt="Map of Nairobi" style="width:100%; height:100%; object-fit: cover; border-radius: 10px;">
            </div>
        </section>

        <section id="contact-page">
            <h2 class="section-title">Contact Us</h2>
            <div class="forms-container contact-form-container">
                <form id="contact-form">
                    <input type="text" id="contact-name" placeholder="Your Name" required>
                    <input type="email" id="contact-email" placeholder="Your Email" required>
                    <textarea id="contact-message" placeholder="Your Message" rows="6" required></textarea>
                    <button type="submit">Send Message</button>
                    <div id="contact-message-status" class="info-message" style="display:none;"></div>
                </form>
                <div class="contact-info">
                    <div>
                        <span class="fas fa-map-marker-alt" style="color: var(--primary-color);"></span>
                        <p>Nairobi, Kenya</p>
                    </div>
                    <div>
                        <span class="fas fa-phone" style="color: var(--primary-color);"></span>
                        <p>+254 712 345 678</p>
                    </div>
                    <div>
                        <span class="fas fa-envelope" style="color: var(--primary-color);"></span>
                        <p>info@princealexstore.co.ke</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="auth-modal" class="modal">
            <div class="modal-content auth-modal-content">
                <span class="close-button fas fa-times"></span>
                <h3 id="auth-modal-title">Log In</h3>
                <form id="auth-form">
                    <input type="email" id="auth-email" placeholder="Email" required>
                    <input type="password" id="auth-password" placeholder="Password" required>
                    <button type="submit" id="auth-submit-btn">Log In</button>
                </form>
                <p style="text-align: center; margin-top: 15px;">
                    <a href="#" id="auth-switch">Don't have an account? Sign Up</a>
                </p>
                <div id="auth-error-message" class="error-message"></div>
            </div>
        </div>

        <div id="quick-view-modal" class="modal">
            <div class="modal-content quick-view-modal-content">
                <span class="close-button fas fa-times"></span>
                <div id="quick-view-content">
                    </div>
            </div>
        </div>

        <div id="order-confirmation-modal" class="modal">
            <div class="modal-content order-confirmation-modal-content">
                <span class="close-button fas fa-times"></span>
                <h3>Order Confirmed!</h3>
                <p>Your order has been placed successfully.</p>
                <p>Order ID: <strong id="order-id-display"></strong></p>
                <p>We will send you a confirmation email shortly.</p>
                <button class="cta-button close-modal">Close</button>
            </div>
        </div>

        <div id="customer-details-modal" class="modal">
            <div class="modal-content customer-details-modal-content">
                <span class="close-button fas fa-times"></span>
                <h3>Customer Details</h3>
                <form id="customer-details-form">
                    <input type="text" id="customer-name" placeholder="Full Name" required>
                    <input type="tel" id="customer-phone" placeholder="Phone Number" required>
                    <textarea id="customer-address" placeholder="Delivery Address" rows="3" required></textarea>
                    <button type="submit">Continue to Payment</button>
                </form>
            </div>
        </div>

        <div id="payment-modal" class="modal">
            <div class="modal-content payment-modal-content">
                <span class="close-button fas fa-times"></span>
                <h3>Payment Method</h3>
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="payment-method" value="mpesa" checked>
                        <span>M-Pesa (Mobile Money)</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment-method" value="cash-on-delivery">
                        <span>Cash on Delivery</span>
                    </label>
                </div>
                <button id="pay-now-btn">Pay Now</button>
            </div>
        </div>

    </main>

    <div class="whatsapp-widget">
        <a href="https://wa.me/254712345678" target="_blank" aria-label="Chat with us on WhatsApp" title="Chat with us on WhatsApp">
            <span class="fab fa-whatsapp"></span>
        </a>
    </div>

    <footer>
        <div class="container footer-grid">
            <div class="footer-column">
                <h4>About Us</h4>
                <p>Providing the freshest farm produce directly from Kenya to your table.</p>
            </div>
            <div class="footer-column">
                <h4>Quick Links</h4>
                <a href="#" class="page-link" data-page="shop">Shop</a>
                <a href="#" class="page-link" data-page="about">About</a>
                <a href="#" class="page-link" data-page="contact">Contact</a>
            </div>
            <div class="footer-column">
                <h4>Contact Info</h4>
                <p>Nairobi, Kenya</p>
                <p>+254 712 345 678</p>
                <p>info@princealexstore.co.ke</p>
            </div>
            <div class="footer-column">
                <h4>Follow Us</h4>
                <div class="social-links">
                    <a href="#"><span class="fab fa-facebook-f"></span></a>
                    <a href="#"><span class="fab fa-twitter"></span></a>
                    <a href="#"><span class="fab fa-instagram"></span></a>
                </div>
            </div>
        </div>
    </footer>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, doc, getDoc, updateDoc, where, setDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAlS1nqRKolwc-7mySezN6XBcwk5p2Al4U",
    authDomain: "prince-alex-store.firebaseapp.com",
    projectId: "prince-alex-store",
    storageBucket: "prince-alex-store.firebasestorage.app",
    messagingSenderId: "266163776280",
    appId: "1:266163776280:web:fdd89c30f84ed03540cc6d"
  };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- Global Variables ---
        let firebaseUser = null;
        let products = [];
        let cart = [];
        const deliveryFee = 250;

        // --- DOM Elements ---
        const navLinks = document.getElementById('nav-links');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const cartCountSpan = document.getElementById('cart-count');
        const authButton = document.getElementById('auth-button');
        const authModal = document.getElementById('auth-modal');
        const authSwitch = document.getElementById('auth-switch');
        const authForm = document.getElementById('auth-form');
        const authTitle = document.getElementById('auth-modal-title');
        const authEmail = document.getElementById('auth-email');
        const authPassword = document.getElementById('auth-password');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authError = document.getElementById('auth-error-message');
        const customerDetailsModal = document.getElementById('customer-details-modal');
        const customerDetailsForm = document.getElementById('customer-details-form');
        const paymentModal = document.getElementById('payment-modal');
        const payNowBtn = document.getElementById('pay-now-btn');
        const cartContentDiv = document.getElementById('cart-content');
        const cartEmptyMessage = document.getElementById('cart-empty-message');
        const cartItemsBody = document.getElementById('cart-items-body');
        const cartSubtotalSpan = document.getElementById('cart-subtotal');
        const cartDeliveryFeeSpan = document.getElementById('cart-delivery-fee');
        const cartTotalSpan = document.getElementById('cart-total');
        const checkoutButton = document.getElementById('checkout-button');
        const quickViewModal = document.getElementById('quick-view-modal');
        const quickViewContent = document.getElementById('quick-view-content');
        const orderConfirmationModal = document.getElementById('order-confirmation-modal');
        const orderIdDisplay = document.getElementById('order-id-display');
        const trackOrderForm = document.getElementById('track-order-form');
        const orderStatusDiv = document.getElementById('order-status');
        const contactForm = document.getElementById('contact-form');
        const contactStatus = document.getElementById('contact-message-status');
        const searchBar = document.getElementById('search-bar');
        const categoryFilter = document.getElementById('category-filter');
        const sortBy = document.getElementById('sort-by');
        const allProductsGrid = document.getElementById('all-products');
        const featuredProductsGrid = document.getElementById('featured-products');
        const gridViewBtn = document.getElementById('grid-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');

        // --- Dark Mode ---
        function applyDarkModePreference() {
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedMode = localStorage.getItem('theme');
            if (savedMode === 'dark' || (!savedMode && prefersDark)) {
                document.body.classList.add('dark-mode');
                darkModeToggle.classList.remove('fa-moon');
                darkModeToggle.classList.add('fa-sun');
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.classList.remove('fa-sun');
                darkModeToggle.classList.add('fa-moon');
            }
        }
        
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                darkModeToggle.classList.remove('fa-moon');
                darkModeToggle.classList.add('fa-sun');
            } else {
                localStorage.setItem('theme', 'light');
                darkModeToggle.classList.remove('fa-sun');
                darkModeToggle.classList.add('fa-moon');
            }
        });

        // --- Page Navigation ---
        document.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = e.target.dataset.page;
                document.querySelectorAll('section').forEach(section => {
                    section.style.display = 'none';
                });
                document.getElementById(`${pageId}-page`).style.display = 'block';
                document.querySelectorAll('.page-link').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');

                // Re-render components for specific pages
                if (pageId === 'cart') {
                    renderCart();
                } else if (pageId === 'shop') {
                    renderProducts(products);
                } else if (pageId === 'auth' && firebaseUser) {
                    // If user is logged in, show account page
                    document.getElementById('auth-page').style.display = 'none';
                    document.getElementById('my-account-page').style.display = 'block';
                    renderAccountDetails();
                }
            });
        });

        // --- Modal Control ---
        document.querySelectorAll('.modal .close-button, .modal .close-modal').forEach(button => {
            button.addEventListener('click', () => {
                button.closest('.modal').style.display = 'none';
            });
        });
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
        
        // --- Utility Functions ---
        function getFromLocalStorage(key, defaultValue) {
            const value = localStorage.getItem(key);
            try {
                return value ? JSON.parse(value) : defaultValue;
            } catch (e) {
                console.error("Error parsing localStorage item", key, e);
                return defaultValue;
            }
        }
        function saveToLocalStorage(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        // --- Authentication ---
        async function updateAuthUI() {
            if (firebaseUser) {
                authButton.textContent = 'Log Out';
                authButton.removeEventListener('click', openAuthModal);
                authButton.addEventListener('click', handleLogout);
                document.querySelector('[data-page="auth"]').dataset.page = 'my-account';
                document.querySelector('[data-page="my-account"]').style.display = 'block';
            } else {
                authButton.textContent = 'Log In';
                authButton.removeEventListener('click', handleLogout);
                authButton.addEventListener('click', openAuthModal);
                document.querySelector('[data-page="auth"]').dataset.page = 'auth';
                document.querySelector('[data-page="my-account"]').style.display = 'none';
            }
        }
        function openAuthModal() {
            authModal.style.display = 'flex';
        }
        async function handleLogout() {
            try {
                await signOut(auth);
                showModal('logout-success-modal');
            } catch (error) {
                console.error("Logout Error:", error);
            }
        }

        authSwitch.addEventListener('click', (e) => {
            e.preventDefault();
            const isLogin = authTitle.textContent === 'Log In';
            authTitle.textContent = isLogin ? 'Sign Up' : 'Log In';
            authSubmitBtn.textContent = isLogin ? 'Sign Up' : 'Log In';
            authSwitch.innerHTML = isLogin ? 'Already have an account? Log In' : 'Don\'t have an account? Sign Up';
            authForm.dataset.mode = isLogin ? 'signup' : 'login';
            authError.textContent = '';
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = authEmail.value;
            const password = authPassword.value;
            const mode = authForm.dataset.mode || 'login';

            try {
                if (mode === 'signup') {
                    await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, "users", auth.currentUser.uid), {
                        email: email,
                        cart: [],
                        wishlist: [],
                        createdAt: new Date().toISOString()
                    });
                    showModal('signup-success-modal');
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                authModal.style.display = 'none';
            } catch (error) {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.error("Auth Error:", errorCode, errorMessage);
                authError.textContent = 'Error: ' + errorMessage;
            }
        });

        // --- Cart Functions ---
        async function getCart() {
            if (firebaseUser) {
                try {
                    const userDoc = await getDoc(doc(db, "users", firebaseUser.uid));
                    return userDoc.exists() ? userDoc.data().cart || [] : [];
                } catch (e) {
                    console.error("Error fetching cart from Firestore:", e);
                    return [];
                }
            } else {
                return getFromLocalStorage('guestCart', []);
            }
        }

        async function saveCart(newCart) {
            if (firebaseUser) {
                try {
                    await updateDoc(doc(db, "users", firebaseUser.uid), {
                        cart: newCart
                    });
                } catch (e) {
                    console.error("Error saving cart to Firestore:", e);
                }
            } else {
                saveToLocalStorage('guestCart', newCart);
            }
            cart = newCart; // Update global cart
            updateCartCount();
        }

        async function addToCart(productId) {
            const productToAdd = products.find(p => p.id === productId);
            if (!productToAdd) return;
            let currentCart = await getCart();
            const existingItem = currentCart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentCart.push({ id: productId, quantity: 1 });
            }

            await saveCart(currentCart);
            renderCart();
            showModal('add-to-cart-success-modal');
        }

        async function updateCartQuantity(productId, newQuantity) {
            let currentCart = await getCart();
            const item = currentCart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                if (item.quantity <= 0) {
                    currentCart = currentCart.filter(item => item.id !== productId);
                }
            }
            await saveCart(currentCart);
            renderCart();
        }

        function updateCartCount() {
            const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountSpan.textContent = totalCount;
        }

        function renderCart() {
            cartItemsBody.innerHTML = '';
            let subtotal = 0;
            if (cart.length === 0) {
                cartEmptyMessage.style.display = 'block';
                cartContentDiv.style.display = 'none';
            } else {
                cartEmptyMessage.style.display = 'none';
                cartContentDiv.style.display = 'block';

                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;
                    const itemTotal = product.price * item.quantity;
                    subtotal += itemTotal;
                    const row = document.createElement('tr');
                    row.className = 'cart-item';
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${product.image}" alt="${product.name}">
                                <span>${product.name}</span>
                            </div>
                        </td>
                        <td>KES ${product.price}</td>
                        <td>
                            <div class="quantity-controls">
                                <button class="decrease-quantity" data-id="${item.id}">-</button>
                                <span>${item.quantity}</span>
                                <button class="increase-quantity" data-id="${item.id}">+</button>
                            </div>
                        </td>
                        <td>KES ${itemTotal.toFixed(2)}</td>
                        <td><button class="remove-from-cart" data-id="${item.id}"><i class="fas fa-trash-alt"></i></button></td>
                    `;
                    cartItemsBody.appendChild(row);
                });
            }

            const total = subtotal + deliveryFee;
            cartSubtotalSpan.textContent = `KES ${subtotal.toFixed(2)}`;
            cartDeliveryFeeSpan.textContent = `KES ${deliveryFee.toFixed(2)}`;
            cartTotalSpan.textContent = `KES ${total.toFixed(2)}`;

            document.querySelectorAll('.increase-quantity').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const id = e.target.dataset.id;
                    const item = cart.find(i => i.id === id);
                    if (item) {
                        await updateCartQuantity(id, item.quantity + 1);
                    }
                });
            });

            document.querySelectorAll('.decrease-quantity').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const id = e.target.dataset.id;
                    const item = cart.find(i => i.id === id);
                    if (item && item.quantity > 1) {
                        await updateCartQuantity(id, item.quantity - 1);
                    } else {
                        await updateCartQuantity(id, 0); // Remove if quantity becomes 0
                    }
                });
            });

            document.querySelectorAll('.remove-from-cart').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const id = e.target.closest('button').dataset.id;
                    let currentCart = await getCart();
                    currentCart = currentCart.filter(item => item.id !== id);
                    await saveCart(currentCart);
                    renderCart();
                });
            });
        }

        // --- Product Display ---
        function renderProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            if (product.badge) {
                card.innerHTML += `<span class="product-badge">${product.badge}</span>`;
            }
            card.innerHTML += `
                <span class="favorite-icon far fa-heart" data-id="${product.id}"></span>
                <img src="${product.image}" alt="${product.name}">
                <h3>${product.name}</h3>
                <p class="product-rating">${renderStars(product.rating)}</p>
                <div class="price">KES ${product.price}</div>
                <div class="stock-indicator ${product.stock > 0 ? 'in-stock' : 'sold-out'}">
                    ${product.stock > 0 ? `${product.stock} in stock` : 'Sold Out'}
                </div>
                <button class="add-to-cart-btn" data-id="${product.id}" ${product.stock === 0 ? 'disabled' : ''}>Add to Cart</button>
                <button class="quick-view-btn" data-id="${product.id}">Quick View</button>
            `;
            return card;
        }

        function renderProducts(productList, targetElement) {
            targetElement.innerHTML = '';
            if (productList.length === 0) {
                targetElement.innerHTML = '<p style="text-align: center;">No products found.</p>';
                return;
            }
            productList.forEach(product => {
                targetElement.appendChild(renderProductCard(product));
            });
            // Add event listeners for new buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    addToCart(e.target.dataset.id);
                });
            });
            document.querySelectorAll('.quick-view-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    openQuickViewModal(e.target.dataset.id);
                });
            });
        }

        function renderStars(rating) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    starsHtml += `<span class="fas fa-star"></span>`;
                } else {
                    starsHtml += `<span class="far fa-star"></span>`;
                }
            }
            return starsHtml;
        }
        
        async function loadProductsFromFirestore() {
            const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
            
            console.log("Loading products...");
            const querySnapshot = await getDocs(q);
            console.log("Products fetched:", querySnapshot.docs.length);

            products = [];
            querySnapshot.forEach((doc) => {
                products.push({ id: doc.id, ...doc.data() });
            });
            
            // Render all products
            renderProducts(products, allProductsGrid);
            
            // Render featured products (e.g., first 4)
            const featuredProducts = products.slice(0, 4);
            renderProducts(featuredProducts, featuredProductsGrid);
        }

        // Search, Filter, Sort
        function filterAndSortProducts() {
            const searchTerm = searchBar.value.toLowerCase();
            const category = categoryFilter.value;
            const sortOption = sortBy.value;

            let filteredProducts = products.filter(product => {
                const nameMatch = product.name.toLowerCase().includes(searchTerm);
                const categoryMatch = category === 'all' || product.category === category;
                return nameMatch && categoryMatch;
            });

            if (sortOption === 'price-asc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (sortOption === 'price-desc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (sortOption === 'rating-desc') {
                filteredProducts.sort((a, b) => b.rating - a.rating);
            } else if (sortOption === 'newest') {
                filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            }
            
            renderProducts(filteredProducts, allProductsGrid);
        }

        searchBar.addEventListener('input', filterAndSortProducts);
        categoryFilter.addEventListener('change', filterAndSortProducts);
        sortBy.addEventListener('change', filterAndSortProducts);
        
        // Wishlist functionality
        document.querySelectorAll('.favorite-icon').forEach(icon => {
            icon.addEventListener('click', async (e) => {
                const productId = e.target.dataset.id;
                if (!firebaseUser) {
                    showModal('login-required-modal'); // Or some login prompt
                    return;
                }
                const userDocRef = doc(db, "users", firebaseUser.uid);
                await updateDoc(userDocRef, {
                    wishlist: arrayUnion(productId)
                });
                e.target.classList.add('fas');
                e.target.classList.remove('far');
            });
        });

        // Quick View Modal
        function openQuickViewModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            quickViewContent.innerHTML = `
                <div class="product-details">
                    <img src="${product.image}" alt="${product.name}">
                    <div class="product-info-qv">
                        <h3>${product.name}</h3>
                        <p class="product-rating">${renderStars(product.rating)}</p>
                        <div class="price-qv">KES ${product.price}</div>
                        <p class="description-qv">${product.description}</p>
                        <p><strong>Category:</strong> ${product.category}</p>
                        <p><strong>Unit:</strong> ${product.unit}</p>
                        <div class="product-tags">
                            ${product.tags.map(tag => `<span class="product-tag">${tag}</span>`).join('')}
                        </div>
                        <button class="add-to-cart-btn-qv" data-id="${product.id}">Add to Cart</button>
                    </div>
                </div>
            `;
            quickViewModal.style.display = 'flex';
            document.querySelector('.add-to-cart-btn-qv').addEventListener('click', (e) => {
                addToCart(e.target.dataset.id);
                quickViewModal.style.display = 'none';
            });
        }
        
        // Checkout Process
        checkoutButton.addEventListener('click', () => {
            if (!firebaseUser) {
                // If not logged in, prompt to log in and save cart to local storage
                saveToLocalStorage('pendingCheckout', true);
                openAuthModal();
            } else {
                openCustomerDetailsModal();
            }
        });

        function openCustomerDetailsModal() {
            customerDetailsModal.style.display = 'flex';
        }

        customerDetailsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const customerName = document.getElementById('customer-name').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const customerAddress = document.getElementById('customer-address').value;
            
            // Save details to user profile
            const userDocRef = doc(db, "users", firebaseUser.uid);
            await updateDoc(userDocRef, {
                name: customerName,
                phone: customerPhone,
                address: customerAddress
            });

            customerDetailsModal.style.display = 'none';
            paymentModal.style.display = 'flex';
        });

        payNowBtn.addEventListener('click', async () => {
            try {
                // Get the latest cart
                const currentCart = await getCart();
                const totalAmount = currentCart.reduce((sum, item) => {
                    const product = products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0) + deliveryFee;

                // Create the order in Firestore
                const orderRef = await addDoc(collection(db, "orders"), {
                    userId: firebaseUser.uid,
                    customerName: document.getElementById('customer-name').value,
                    customerEmail: firebaseUser.email,
                    customerAddress: document.getElementById('customer-address').value,
                    customerPhone: document.getElementById('customer-phone').value,
                    items: currentCart,
                    totalAmount: totalAmount,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                });
                
                // Clear cart in Firestore and local storage
                await saveCart([]);

                paymentModal.style.display = 'none';
                orderIdDisplay.textContent = orderRef.id;
                orderConfirmationModal.style.display = 'flex';
            } catch (e) {
                console.error("Error during checkout:", e);
                // Handle error
            }
        });

        // Track Order Functionality
        trackOrderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const orderId = document.getElementById('order-id-input').value;
            orderStatusDiv.textContent = 'Searching for order...';
            orderStatusDiv.style.color = '#333';
            try {
                const orderDoc = await getDoc(doc(db, "orders", orderId));
                if (orderDoc.exists()) {
                    const orderData = orderDoc.data();
                    orderStatusDiv.innerHTML = `
                        Order ID: <strong>${orderId}</strong><br>
                        Status: <strong>${orderData.status.charAt(0).toUpperCase() + orderData.status.slice(1)}</strong><br>
                        Total: <strong>KES ${orderData.totalAmount.toFixed(2)}</strong>
                    `;
                } else {
                    orderStatusDiv.textContent = 'Order not found. Please check the ID.';
                    orderStatusDiv.style.color = '#f44336';
                }
            } catch (e) {
                console.error("Error fetching order:", e);
                orderStatusDiv.textContent = 'Error tracking order. Please try again.';
                orderStatusDiv.style.color = '#f44336';
            }
        });

        // Contact Form
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;

            try {
                await addDoc(collection(db, "contactSubmissions"), {
                    name,
                    email,
                    message,
                    timestamp: new Date().toISOString()
                });
                contactStatus.textContent = "Thank you for your message! We'll get back to you soon.";
                contactStatus.className = 'info-message success';
                contactStatus.style.display = 'block';
                contactForm.reset();
            } catch (e) {
                console.error("Error adding contact submission:", e);
                contactStatus.textContent = "Failed to send message. Please try again.";
                contactStatus.className = 'info-message error';
                contactStatus.style.display = 'block';
            }
        });

        // Other Utilities
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // View Toggles
        gridViewBtn.addEventListener('click', () => {
            allProductsGrid.classList.remove('list-view');
        });

        listViewBtn.addEventListener('click', () => {
            allProductsGrid.classList.add('list-view');
        });

        // Hero Image Carousel
        let currentImageIndex = 0;
        const heroImages = document.querySelectorAll('.hero-background-image');
        function rotateHeroImages() {
            heroImages[currentImageIndex].classList.remove('active');
            currentImageIndex = (currentImageIndex + 1) % heroImages.length;
            heroImages[currentImageIndex].classList.add('active');
        }
        setInterval(rotateHeroImages, 5000);

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            applyDarkModePreference();
            // Initial page load, will be handled by onAuthStateChanged
        });

        onAuthStateChanged(auth, async (user) => {
            firebaseUser = user; // Update the global firebaseUser variable
            await updateAuthUI(); // Update UI based on auth state

            // Load products and update cart count after Firebase is ready
            await loadProductsFromFirestore();
            await updateCartCount();

            // Handle pending checkout after Firebase login
            if (user && getFromLocalStorage('pendingCheckout', false)) {
                localStorage.removeItem('pendingCheckout');
                openCustomerDetailsModal(); // Resume checkout
            }
            // If a guest logs in, merge their local cart with their Firestore cart
            if (user) {
                const guestCart = getFromLocalStorage('guestCart', []);
                if (guestCart.length > 0) {
                    let userCart = await getCart();
                    // Merge logic: add guest items to user cart, handling duplicates
                    guestCart.forEach(guestItem => {
                        const existingUserItem = userCart.find(item => item.id === guestItem.id);
                        if (existingUserItem) {
                            existingUserItem.quantity += guestItem.quantity;
                        } else {
                            userCart.push(guestItem);
                        }
                    });
                    await saveCart(userCart);
                    localStorage.removeItem('guestCart'); // Clear guest cart after merge
                    await updateCartCount();
                }
            }
        });

    </script>

</body>
</html>
